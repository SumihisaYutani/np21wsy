# NP21WSY サウンド設定マニュアル

## 1. 概要

本マニュアルでは、NP21WSY PC-9801エミュレータのサウンド設定について詳しく説明します。
PC-9801シリーズは豊富な音源ボードが利用でき、適切な設定により高品質なサウンドが楽しめます。

---

## 2. 基本サウンド設定

### 2.1 サンプリングレート設定

#### 設定項目: `SampleHz`
サウンドの品質と負荷を決定する重要な設定です。

| 設定値 | 品質 | CPU負荷 | 用途 |
|--------|------|---------|------|
| `11025` | 低品質 | 軽い | 低性能PC |
| `22050` | 中品質 | 普通 | 一般的な用途 |
| `44100` | 高品質 | 重い | 推奨設定 |
| `48000` | 最高品質 | 最重 | 高性能PC |

**推奨設定:**
```ini
SampleHz=44100
```

### 2.2 オーディオレイテンシ設定

#### 設定項目: `Latencys`
サウンドの遅延時間をミリ秒単位で指定します。

| 設定値 | 遅延 | 用途 |
|--------|------|------|
| `50` | 超低遅延 | リアルタイム演奏 |
| `100` | 低遅延 | ゲーム |
| `150` | 標準 | 推奨設定 |
| `200` | 高遅延 | 安定重視 |
| `300` | 超高遅延 | 問題回避 |

**設定例:**
```ini
Latencys=150
```

**注意事項:**
- 低遅延設定は高性能PCが必要
- 音飛びが発生する場合は値を大きくする
- MIDIリアルタイム入力時は低遅延推奨

---

## 3. サウンドボード設定

### 3.1 メインサウンドボード

#### 設定項目: `SNDboard`
搭載するサウンドボードを指定します。

#### 3.1.1 基本音源ボード

**PC-9801-14 (PSG音源)**
```ini
SNDboard=01
```
- **特徴**: 3音同時発音、矩形波音源
- **用途**: 初期のゲーム、効果音
- **対応ソフト**: 初期のPC-9801ソフト全般

**PC-9801-26K (FM音源)**
```ini
SNDboard=02
```
- **特徴**: YM2203(OPN) 6音FM + 3音PSG
- **用途**: 中期のゲーム、音楽再生
- **対応ソフト**: 1988年頃〜のソフト

**PC-9801-86 (FM+PCM音源) - 推奨**
```ini
SNDboard=04
```
- **特徴**: YM2608(OPNA) 6音FM + ADPCM + リズム
- **用途**: 最も一般的、高品質サウンド
- **対応ソフト**: 1990年代のゲーム・音楽ソフト

**PC-9801-118 (PCM音源)**
```ini
SNDboard=08
```
- **特徴**: Windows Sound System互換 PCM
- **用途**: Windows用途、WAVEファイル再生
- **対応ソフト**: Windows 3.1、95対応ソフト

#### 3.1.2 併用設定

**PC-9801-86 + 26K**
```ini
SNDboard=06
```
- **特徴**: 86と26Kの同時搭載
- **用途**: 最高の互換性
- **注意**: I/O競合に注意

**PC-9801-86 + Sound Blaster 16**
```ini
SNDboard=44
```
- **特徴**: 86 + SB16互換
- **用途**: DOS/V併用環境
- **対応**: SoundBlaster対応ソフト

#### 3.1.3 特殊音源

**スピークボード (音声合成)**
```ini
SNDboard=20
```
- **特徴**: 音声合成専用
- **用途**: 音声合成ソフト
- **代表ソフト**: 一太郎ver.3等

**AMD-98 (高品質FM)**
```ini
SNDboard=80
```
- **特徴**: AMD製高品質FM音源
- **用途**: 音楽制作、高音質再生
- **注意**: 対応ソフトが限定的

### 3.2 サウンドボード詳細設定

#### 3.2.1 PC-9801-14設定

```ini
snd14opt=00 00 20
```

**パラメータ詳細:**
- **1バイト目**: 基本設定 (通常 `00`)
- **2バイト目**: 拡張設定 (通常 `00`)
- **3バイト目**: 音量調整 (`20` = 標準)

#### 3.2.2 PC-9801-26K設定

```ini
snd26opt=00
```

**パラメータ詳細:**
- **bit0-3**: ジャンパ設定
- **bit4-7**: I/Oアドレス設定

#### 3.2.3 PC-9801-86設定

```ini
snd86opt=00
```

**パラメータ詳細:**
- **bit0**: OPNA/OPN選択
- **bit1**: PCM有効/無効
- **bit2-3**: I/Oベースアドレス
- **bit4-7**: 拡張設定

#### 3.2.4 PC-9801-118設定

```ini
snd118io=188
snd118id=01
snd118dma=01
snd118irqf=0a
snd118irqp=05
snd118irqm=03
snd118rom=01
```

**パラメータ詳細:**
- **snd118io**: I/Oベースアドレス (0x188, 0x288等)
- **snd118id**: ボードID (01-0F)
- **snd118dma**: DMAチャンネル (0-3)
- **snd118irqf**: FIFOサイズ設定
- **snd118irqp**: プレイIRQ
- **snd118irqm**: マイクIRQ
- **snd118rom**: BIOS ROM使用

#### 3.2.5 Sound Blaster 16設定

```ini
sndsb16io=00
sndsb16dma=01
sndsb16irq=05
sndsb16at=00
```

**パラメータ詳細:**
- **sndsb16io**: I/Oアドレス (00=220h, 01=240h等)
- **sndsb16dma**: DMAチャンネル
- **sndsb16irq**: IRQ番号 (5,7,9,10)
- **sndsb16at**: AT互換モード

---

## 4. 音量設定

### 4.1 マスター音量

#### 設定項目: `volume_M`
全体の音量を制御します。

```ini
volume_M=100
```
- **範囲**: 0-100
- **デフォルト**: 100
- **効果**: 全音源の音量を一括制御

### 4.2 音源別音量設定

#### FM音源音量: `volume_F`
```ini
volume_F=64
```
- **範囲**: 0-128
- **デフォルト**: 64
- **対象**: YM2203/YM2608のFM音源部

#### PSG音量: `volume_S`
```ini
volume_S=64
```
- **範囲**: 0-128
- **デフォルト**: 64
- **対象**: PSG音源、FM音源のSSG部

#### ADPCM音量: `volume_A`
```ini
volume_A=64
```
- **範囲**: 0-128
- **デフォルト**: 64
- **対象**: ADPCM PCM音源

#### PCM音量: `volume_P`
```ini
volume_P=64
```
- **範囲**: 0-128
- **デフォルト**: 64
- **対象**: デジタルPCM音源

#### リズム音量: `volume_R`
```ini
volume_R=64
```
- **範囲**: 0-128
- **デフォルト**: 64
- **対象**: FM音源のリズム音源

#### MIDI音量: `volume_Y`
```ini
volume_Y=128
```
- **範囲**: 0-128
- **デフォルト**: 128
- **対象**: MIDI出力

#### BEEP音量: `BEEP_vol`
```ini
BEEP_vol=3
```
- **範囲**: 0-3
- **デフォルト**: 3
- **対象**: システムBEEP音

### 4.3 PC-9801-14専用音量設定

```ini
vol14=40 40 40 40 40 40
```

**6バイト設定:**
- **1-3バイト**: PSG チャンネル1-3の音量
- **4-6バイト**: 予備チャンネル音量

---

## 5. MIDI設定

### 5.1 MIDI出力設定

#### MPU-98 II設定
```ini
mpuenable=0
mpuopt=00
mpu_at=00
```

**パラメータ詳細:**
- **mpuenable**: MPU-98 II使用 (0=無効, 1=有効)
- **mpuopt**: 動作オプション
- **mpu_at**: AT互換モード

#### Smart MPU-98設定
```ini
smpuenable=0
smpuopt=00
smpumuteB=0
```

**パラメータ詳細:**
- **smpuenable**: Smart MPU-98使用
- **smpuopt**: 動作オプション
- **smpumuteB**: Bパート無音化

### 5.2 PC-9861K (RS-232C)設定

```ini
pc9861enable=0
pc9861sw=73 73 83
pc9861jmp=ff ff ff ff ff ff
```

**パラメータ詳細:**
- **pc9861enable**: PC-9861K使用
- **pc9861sw**: DIPスイッチ設定 (3バイト)
- **pc9861jmp**: ジャンパ設定 (6バイト)

---

## 6. プラットフォーム別サウンド設定

### 6.1 Windows版サウンド設定

#### DirectSound設定
```ini
SOUND_SW=00
snd_x=00
```

#### ASIO設定 (対応版のみ)
```ini
asio_device=0
asio_buffer=512
```

### 6.2 SDL2版サウンド設定

#### SDL Audio設定
```ini
SOUND_SW=00
audiobuff=4096
```

### 6.3 ALSA設定 (Linux)

#### ALSA デバイス設定
```ini
alsa_device=default
alsa_buffer=4096
```

---

## 7. サウンド品質最適化

### 7.1 高品質設定

**音楽鑑賞・制作用途**
```ini
SampleHz=44100
Latencys=100
SNDboard=04
volume_M=90
volume_F=80
volume_S=64
volume_A=80
volume_P=90
volume_R=70
volume_Y=100
BEEP_vol=1
```

### 7.2 ゲーム用設定

**ゲームプレイ最適化**
```ini
SampleHz=44100
Latencys=150
SNDboard=04
volume_M=100
volume_F=64
volume_S=64
volume_A=64
volume_P=64
volume_R=64
volume_Y=64
BEEP_vol=2
```

### 7.3 低負荷設定

**低性能PC向け**
```ini
SampleHz=22050
Latencys=200
SNDboard=02
volume_M=100
volume_F=64
volume_S=64
BEEP_vol=3
```

---

## 8. 音源ボード互換性ガイド

### 8.1 時代別推奨設定

#### 1987-1989年 (初期)
```ini
SNDboard=01  # PC-9801-14
```
- **対象**: 初期のゲーム、BASIC音楽
- **特徴**: PSGのみ、シンプルなサウンド

#### 1989-1991年 (中期)
```ini
SNDboard=02  # PC-9801-26K
```
- **対象**: FM音源対応ゲーム
- **特徴**: 豊かなFMサウンド

#### 1991-1995年 (後期)
```ini
SNDboard=04  # PC-9801-86
```
- **対象**: 高品質サウンドゲーム
- **特徴**: FM + ADPCM、リズム音源

#### 1995年以降 (Windows時代)
```ini
SNDboard=08  # PC-9801-118
```
- **対象**: Windows対応ソフト
- **特徴**: PCMサウンド、WAVEファイル

### 8.2 ソフトウェア別推奨設定

#### 音楽ソフト
- **推奨**: PC-9801-86 (`SNDboard=04`)
- **理由**: 高品質FM + ADPCM

#### アクションゲーム
- **推奨**: PC-9801-86 (`SNDboard=04`)
- **理由**: 効果音 + BGMのバランス

#### RPG・アドベンチャー
- **推奨**: PC-9801-26K (`SNDboard=02`) または PC-9801-86 (`SNDboard=04`)
- **理由**: BGM重視

#### 初期ソフトウェア
- **推奨**: PC-9801-14 (`SNDboard=01`)
- **理由**: 対応音源がPSGのみ

---

## 9. トラブルシューティング

### 9.1 音が出ない

**原因と対策:**

1. **音量設定確認**
   ```ini
   volume_M=100
   ```

2. **サウンドボード設定確認**
   ```ini
   SNDboard=04  # 確実に動作する設定
   ```

3. **サンプリングレート変更**
   ```ini
   SampleHz=22050  # 負荷軽減
   ```

### 9.2 音飛び・ノイズ

**原因と対策:**

1. **レイテンシ調整**
   ```ini
   Latencys=200  # 遅延増加で安定化
   ```

2. **サンプリングレート下げ**
   ```ini
   SampleHz=22050  # 負荷軽減
   ```

3. **CPU負荷軽減**
   - クロック倍率を下げる
   - 他のプロセスを終了

### 9.3 特定の音が出ない

**原因と対策:**

1. **対応音源確認**
   - ソフトウェアの対応音源を確認
   - 適切なサウンドボードに変更

2. **音量バランス調整**
   ```ini
   volume_F=80   # FM音量上げ
   volume_S=80   # PSG音量上げ
   volume_A=80   # ADPCM音量上げ
   ```

### 9.4 MIDI音が出ない

**原因と対策:**

1. **MIDI設定確認**
   ```ini
   mpuenable=1   # MPU-98 II有効化
   volume_Y=128  # MIDI音量最大
   ```

2. **システムMIDI設定**
   - OS側のMIDI設定確認
   - MIDIデバイスの接続確認

---

## 10. 設定テンプレート集

### 10.1 万能設定
```ini
[NekoProjectII]
SampleHz=44100
Latencys=150
SNDboard=04
volume_M=100
volume_F=64
volume_S=64
volume_A=64
volume_P=64
volume_R=64
volume_Y=128
BEEP_vol=3
```

### 10.2 高音質設定
```ini
[NekoProjectII]
SampleHz=48000
Latencys=100
SNDboard=06
volume_M=90
volume_F=80
volume_S=70
volume_A=85
volume_P=90
volume_R=75
volume_Y=128
BEEP_vol=1
```

### 10.3 軽量設定
```ini
[NekoProjectII]
SampleHz=22050
Latencys=250
SNDboard=02
volume_M=100
volume_F=64
volume_S=64
BEEP_vol=2
```

この設定マニュアルを参考に、お使いの環境とソフトウェアに最適なサウンド設定を行ってください。