# NP21WSY - Enhanced PC-9801/9821 Emulator

## 概要

NP21WSYは、PC-9801/9821エミュレータ「Neko Project 21/W」の拡張版です。200スロット対応のステートセーブ機能とモダンなGUI管理画面を追加し、使用性を大幅に向上させました。

## 主な新機能

### 🎮 200スロット拡張ステートセーブ
- **従来の10倍**: 10スロットから200スロットに大幅拡張
- **T98-NEXT風GUI**: 直感的なState Manager画面
- **サムネイル表示**: セーブ時点の画面キャプチャ
- **自動整理**: SaveStatesフォルダによるファイル管理

### 🖼️ State Manager GUI
- **起動時自動表示**: エミュレータ起動と同時に管理画面表示
- **ListView形式**: 一覧性の高いスロット管理
- **重複回避**: メインウィンドウと重ならない自動配置
- **簡単操作**: クリック操作でのセーブ/ロード

## ファイル構造

```
NP21WSY/
├── bin/x64/Release/
│   ├── np21x64w.exe          # メイン実行ファイル
│   ├── np21x64w.ini          # 設定ファイル
│   └── SaveStates/           # ステートセーブ管理フォルダ
│       ├── state_000.dat     # ステートファイル
│       ├── state_000.dat.png # サムネイル画像
│       └── ... (最大200スロット)
├── docs/                     # 技術文書
├── win9x/                    # Windowsソースコード
└── README.md                 # このファイル
```

## 動作環境

### 必要環境
- **OS**: Windows 10/11 (x64)
- **CPU**: Intel/AMD x64プロセッサ
- **メモリ**: 最低1GB RAM
- **DirectX**: DirectDraw対応

### 推奨環境
- **メモリ**: 2GB以上のRAM
- **ストレージ**: SSD推奨（高速なディスクアクセス）

## セットアップ

### 1. 実行ファイルの配置
```
np21x64w.exe を任意のフォルダに配置
```

### 2. BIOSファイルの準備
以下のファイルを実行ファイルと同じフォルダに配置：
- `bios.rom` - PC-9801/9821のBIOS ROM
- `font.rom` - フォントROM
- `sound.rom` - サウンドROM（オプション）

**注意**: BIOSファイルは著作権の関係で本パッケージに含まれません。実機から別途入手してください。

### 3. 起動確認
```bash
# 実行ファイルをダブルクリックまたは
np21x64w.exe
```

## 使用方法

### State Manager操作

#### 基本操作
1. **エミュレータ起動**: 自動的にState Manager画面が表示されます
2. **セーブ**: 使用したいスロットを選択し「Save」ボタン
3. **ロード**: 読み込みたいスロットを選択し「Load」ボタン
4. **削除**: 不要なスロットを選択し「Delete」ボタン

#### サムネイル機能
- セーブ時に自動的に画面キャプチャを保存
- 一覧画面でセーブ時点の状況を視覚的に確認可能
- PNG形式で高品質保存

#### ファイル管理
- 全てのステートファイルは`SaveStates/`フォルダに自動整理
- `state_XXX.dat` + `state_XXX.dat.png` の組み合わせ
- 手動でのバックアップ・復元も可能

## 技術仕様

### ステートセーブ拡張
- **スロット数**: 200スロット (000-199)
- **ファイル形式**: 独自バイナリ形式 (.dat)
- **サムネイル**: PNG形式、自動リサイズ
- **エラーハンドリング**: 詳細なエラー情報とリカバリ機能

### GUI実装
- **フレームワーク**: Win32 API + CustomWindow
- **レンダリング**: DirectDraw/Direct3D対応
- **レスポンシブ**: ウィンドウリサイズ対応

## 開発情報

### ビルド環境
- **Visual Studio**: 2022 Community (Platform Toolset v143)
- **アセンブラ**: NASM (x86), YASM (x64)
- **SDK**: Windows 10 SDK

### アーキテクチャ
```
NP21WSY Core
├── PC-9801/9821 Emulation Engine
├── Enhanced State Save System (200 slots)
├── State Manager GUI (T98-NEXT style)
├── Thumbnail Generation System
└── File Management System
```

## 変更履歴

### v1.0 (2025-09-23)
- ✅ 200スロットステートセーブ機能実装
- ✅ State Manager GUI追加
- ✅ サムネイル表示機能実装
- ✅ SaveStatesフォルダ自動管理
- ✅ エラーハンドリング改善
- ✅ 起動時自動表示機能
- ⚠️ ウィンドウサイズ保存機能は技術的制約により削除

## 既知の制限事項

### 技術的制限
- **BIOSファイル**: 別途入手が必要
- **プラットフォーム**: Windows専用
- **描画システム**: DirectDraw依存

### 機能制限
- **ウィンドウサイズ保存**: 表示システムとの相性問題により未実装
- **ネットワーク機能**: 現バージョンでは未対応

## トラブルシューティング

### よくある問題

#### 1. 起動しない
```
原因: BIOSファイルが不足
解決: bios.rom, font.romを配置
```

#### 2. State Managerが表示されない
```
原因: 初期化エラー
解決: 管理者権限で実行
```

#### 3. サムネイルが表示されない
```
原因: PNG生成エラー
解決: 実行フォルダの書き込み権限確認
```

### ログファイル
```
debug_direct.log - 詳細な動作ログ
```

## ライセンス

本プロジェクトは、オリジナルのNeko Project 21/Wのライセンスに準拠します。

### 著作権表示
- **オリジナル**: Neko Project 21/W Development Team
- **拡張開発**: NP21WSY Enhancement Project
- **BIOS**: 各メーカーの著作物（別途入手が必要）

## サポート

### バグ報告
GitHubのIssuesまたは開発コミュニティまでご報告ください。

### 機能要望
State Manager機能の改善提案を歓迎します。

## 謝辞

- Neko Project 21/W開発チームの皆様
- PC-9801/9821エミュレーション技術への貢献者の皆様
- テスト・フィードバックをいただいたユーザーの皆様

---

**開発**: Claude Code & User
**最終更新**: 2025-09-23
**バージョン**: 1.0 Enhanced State Save Edition