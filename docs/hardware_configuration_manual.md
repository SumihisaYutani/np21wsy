# NP21WSY ハードウェア設定マニュアル

## 1. 概要

本マニュアルでは、NP21WSY PC-9801エミュレータのハードウェア設定について詳しく説明します。
PC-9801シリーズの豊富なハードウェア構成を忠実に再現するため、適切な設定が重要です。

---

## 2. 基本システム設定

### 2.1 PCモデル設定

#### 設定項目: `pc_model`
PC-9801シリーズの機種を選択します。

| 設定値 | 機種名 | 特徴 |
|--------|--------|------|
| `VF` | PC-9801VF | 8086 CPU、基本モデル |
| `VM` | PC-9801VM | 8086 CPU、改良版 |
| `VX` | PC-9801VX | V30 CPU、標準的な選択 |
| `U2` | PC-9801U2 | ラップトップ型 |
| `U6` | PC-9801U6 | ラップトップ型、改良版 |
| `FA` | PC-9801FA | 80286 CPU |
| `FS` | PC-9801FS | 80286 CPU、改良版 |
| `FX` | PC-9801FX | 80286 CPU、高性能版 |

**推奨設定:**
- **初心者**: `VX` - 最も互換性が高い
- **高性能**: `FX` - 80286の性能を活用
- **特定ソフト**: ソフトウェアの動作確認済み機種

#### 設定例:
```ini
[NekoProjectII]
pc_model=VX
```

### 2.2 DIPスイッチ設定

#### 設定項目: `DIPswtch`
ハードウェア動作を制御するDIPスイッチの設定です。

**DIPスイッチ1 (第1バイト)**

| ビット | 機能 | 0 | 1 |
|--------|------|---|---|
| 0 | 画面モード | 通常 | ハイレゾ(31kHz) |
| 1 | メモリスイッチ | 無効 | 有効 |
| 2 | ブートデバイス | FDD | HDD |
| 3 | 起動モード | BASIC | DOS |
| 4 | コプロセッサ | なし | あり |
| 5 | グラフィック | CGA互換 | EGC |
| 6 | RS-232C | なし | あり |
| 7 | 未使用 | - | - |

**DIPスイッチ2 (第2バイト)**

| ビット | 機能 | 0 | 1 |
|--------|------|---|---|
| 0-1 | 基本メモリ | 64KB, 96KB, 128KB, 256KB |
| 2-3 | 拡張メモリ | なし, 128KB, 256KB, 512KB |
| 4 | 画面表示 | 24行 | 20行 |
| 5 | カーソル点滅 | 高速 | 低速 |
| 6 | キーリピート | 遅い | 速い |
| 7 | 画面反転 | ノーマル | リバース |

**DIPスイッチ3 (第3バイト)**

| ビット | 機能 | 0 | 1 |
|--------|------|---|---|
| 0-2 | シリアル設定 | ボーレート設定 |
| 3 | プリンタ | セントロ | シリアル |
| 4-6 | サウンドボード | 音源ボード設定 |
| 7 | MIDI | なし | あり |

**推奨設定:**
```ini
DIPswtch=3e 73 7b
```
- 標準的なPC-9801VX相当の設定
- EGCグラフィック有効
- DOS起動、HDD優先
- サウンドボード有効

### 2.3 メモリスイッチ設定

#### 設定項目: `MEMswtch`
拡張機能とハードウェア構成を制御します。

**8バイトのメモリスイッチ構成:**

**スイッチ1-2: システム設定**
- `48 05`: 標準的なPC-9801設定
- CPU種別、FPU有無、カレンダー設定

**スイッチ3-4: メモリ構成**
- `04 00`: 拡張メモリ構成
- バンク切り替え、EMS設定

**スイッチ5-6: I/O設定**
- `01 00`: I/Oポート構成
- RS-232C、プリンタ設定

**スイッチ7-8: 拡張設定**
- `00 6e`: 追加機能設定
- PC-9821拡張、グラフィック設定

**推奨設定:**
```ini
MEMswtch=48 05 04 00 01 00 00 6e
```

---

## 3. CPU・メモリ設定

### 3.1 CPUクロック設定

#### 基本クロック: `clk_base`
PC-9801シリーズの基本動作クロックです。

| 設定値 | 周波数 | 機種 |
|--------|--------|------|
| `2457600` | 2.4576MHz | PC-9801(無印)〜VX |
| `1996800` | 1.9968MHz | 一部の特殊機種 |

#### クロック倍率: `clk_mult`
基本クロックに対する倍率です。

| 設定値 | 実効速度 | 用途 |
|--------|----------|------|
| `1` | 2.5MHz | 初期のソフトウェア |
| `2` | 5MHz | 標準的な動作 |
| `4` | 10MHz | 推奨設定 |
| `8` | 20MHz | 高速動作 |
| `16` | 40MHz | 最高速度 |

**注意事項:**
- 古いソフトウェアは低速設定が必要な場合あり
- 高速設定では一部のタイミング依存ソフトが正常動作しない

### 3.2 メモリ設定

#### 拡張メモリ: `ExMemory`
640KB超のメモリを設定します。

| 設定値 | 総メモリ | 用途 |
|--------|----------|------|
| `0` | 640KB | 最小構成 |
| `1` | 1MB | 基本的な用途 |
| `4` | 4MB | Windows 3.1等 |
| `8` | 8MB | 一般的な設定 |
| `13` | 13MB | 推奨設定 |
| `16` | 16MB | 最大値（通常使用） |
| `32` | 32MB | 大容量メモリ |

**メモリ配置:**
- `000000h-09FFFFh`: 基本メモリ (640KB)
- `0A0000h-0BFFFFh`: VRAM領域
- `100000h-`: 拡張メモリ (1MB以上)

---

## 4. 拡張ボード設定

### 4.1 サウンドボード

#### 設定項目: `SNDboard`
搭載するサウンドボードを指定します。

| 設定値 | ボード名 | 特徴 |
|--------|----------|------|
| `00` | なし | BEEPのみ |
| `01` | PC-9801-14 | 3音PSG |
| `02` | PC-9801-26K | FM6音+PSG3音 |
| `04` | PC-9801-86 | FM6音+PCM |
| `06` | PC-9801-86+26K | 86と26Kの併用 |
| `08` | PC-9801-118 | WSS互換PCM |
| `20` | スピークボード | 音声合成 |
| `41` | Sound Blaster 16 | SB16互換 |
| `80` | AMD-98 | AMD製音源 |

**推奨設定:**
```ini
SNDboard=04
```
PC-9801-86は最も互換性が高く、多くのゲームで使用されます。

### 4.2 ネットワークボード

#### LGY-98設定 (対応版のみ)
```ini
uselgy98=1
lgy98io=d0
lgy98irq=6
lgy98mac=00 1c 23 45 67 89
```

- `uselgy98`: LGY-98使用可否
- `lgy98io`: I/Oベースアドレス
- `lgy98irq`: 使用IRQ番号
- `lgy98mac`: MACアドレス

### 4.3 グラフィックボード

#### PEGC設定 (PC-9821向け)
```ini
usepegc=1
pegctype=1
```

#### Cirrus Logic GD5430設定
```ini
usegd5430=1
gd5430type=1
```

---

## 5. 入力デバイス設定

### 5.1 キーボード設定

#### キーボード種別: `KEY_MODE`
| 設定値 | キーボード | 特徴 |
|--------|------------|------|
| `0` | 標準キーボード | 一般的な設定 |
| `1` | 英語キーボード | US配列 |
| `2` | 106キーボード | 新配列 |

#### キーリピート設定
```ini
BTN_RAPID=31
BTN_MODE=1
```

### 5.2 マウス設定

#### マウス動作設定
```ini
MOUSERAPID=0
```
- `0`: 通常速度
- `1`: 高速動作

---

## 6. プラットフォーム固有設定

### 6.1 Windows版固有設定

#### 画面表示設定
```ini
windtype=0     # ウィンドウ表示方式
toolwind=0     # ツールウィンドウ表示
thickfrm=0     # 太いフレーム
```

#### DirectDraw設定
```ini
EMUDDRAW=0     # DirectDraw エミュレーション
DRAWTYPE=0     # 描画方式選択
```

#### システム統合
```ini
syskhook=0     # システムキーフック
rawmouse=0     # Rawマウス入力
```

### 6.2 SDL2版設定

#### 画面設定
```ini
fullscreen=0   # フルスクリーン
winposx=100    # ウィンドウX座標
winposy=100    # ウィンドウY座標
```

---

## 7. 設定の適用タイミング

### 7.1 即座に反映される設定
- 音量設定
- マウス設定
- 画面表示設定
- キーボード設定

### 7.2 再起動が必要な設定
- PCモデル変更
- クロック設定
- メモリ設定
- DIPスイッチ
- メモリスイッチ
- サウンドボード変更

---

## 8. 設定例

### 8.1 高互換性設定
```ini
[NekoProjectII]
pc_model=VX
clk_base=2457600
clk_mult=4
ExMemory=8
DIPswtch=3e 73 7b
MEMswtch=48 05 04 00 01 00 00 6e
SNDboard=04
```

### 8.2 高性能設定
```ini
[NekoProjectII]
pc_model=FX
clk_base=2457600
clk_mult=8
ExMemory=16
DIPswtch=3e 73 7b
MEMswtch=48 05 04 00 01 00 00 6e
SNDboard=06
```

### 8.3 最小構成設定
```ini
[NekoProjectII]
pc_model=VF
clk_base=2457600
clk_mult=1
ExMemory=0
DIPswtch=3c 30 00
MEMswtch=40 00 00 00 00 00 00 00
SNDboard=00
```

---

## 9. トラブルシューティング

### 9.1 よくある問題

**問題: ソフトウェアが起動しない**
- PCモデルを変更してみる
- クロック倍率を下げる
- DIPスイッチを確認

**問題: 音が出ない**
- サウンドボード設定を確認
- 音量設定をチェック
- サンプリングレートを変更

**問題: 画面が正しく表示されない**
- DIPスイッチの画面モード設定
- グラフィック設定を確認

### 9.2 設定ファイルの場所

**Windows版:**
- 実行ファイルと同じディレクトリの `.ini` ファイル

**SDL2版:**
- 実行ファイルと同じディレクトリの `np2.cfg`

**X11版:**
- ホームディレクトリまたは設定ディレクトリ

---

このマニュアルを参考に、使用したいソフトウェアに適した設定を行ってください。